## Build everything (runs integration tests but skips unit tests)

```bash
mvn clean install
```

## To test just the coordinator:

```bash
mvn -f lra-coordinator/pom.xml -Dmaven.failsafe.debug verify
```

## Run an integration test

### Start the org.jboss.narayana.rts.lra.coordinator on port 8080

```bash
mvn -f lra-coordinator/pom.xml wildfly-swarm:run -DskipTests -Dswarm.debug.port=5006
```

### Start a service on port 8081

```bash
mvn -f lra-test/pom.xml clean wildfly-swarm:run -Dswarm.debug.port=5007 -DskipTests -Dswarm.http.port=8081 
```

### Exercise the coordinator and participant running on ports 8080  and 8081 respectively

```bash
mvn test -f lra-client/pom.xml -Dtest=SpecTest -DskipTests=false
```
## Trip Demo

     * start LRA 1
     *   Book hotel
     *   start LRA 2
     *     start LRA 3
     *       Book flight option 1
     *     start LRA 4
     *       Book flight option 2
     *
     *   cancel LRA 3
     *   close LRA 1 (results in the hotel and flight option 2 being confirmed)

### Start the org.jboss.narayana.rts.lra.coordinator on port 8080

```bash
mvn -f lra-coordinator/pom.xml wildfly-swarm:run -DskipTests -Dswarm.debug.port=5006
```
### Start the service on port 8081

For simplicity the trip, hotel and flight services all listen on the same http port but
inter service requests are still performed using http so running each service in a separate
JVM is an option too.


```bash
mvn -f lra-test/pom.xml clean wildfly-swarm:run -Dswarm.debug.port=5007 -DskipTests -Dswarm.http.port=8081 
```

### Book a trip

```bash
curl -X POST  "http://localhost:8081/trip/book?hotelName=Rex&flightNumber=BA123"
curl -X POST  "http://localhost:8081/trip/book?hotelName=Rex"
curl -X POST  "http://localhost:8081/trip/book?flightNumber=BA123"

```

### Uodate a trip booking

Make a provisional booking and then amend it before confirming the booking. Apart from using
Jackson for parsing Json the client only uses Java SE APIs.


```bash
mvn package -f lra-test/pom.xml

java -agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005 -cp lra-test/target/classes:lra-test/target/lra-test/WEB-INF/lib/jackson-jaxrs-json-provider-2.7.4.jar:lra-test/target/lra-test/WEB-INF/lib/javax.json-1.0.3.jar:lra-test/target/lra-test/WEB-INF/lib/jackson-databind-2.7.4.jar:lra-test/target/lra-test/WEB-INF/lib/jackson-core-2.7.4.jar:lra-test/target/lra-test/WEB-INF/lib/jackson-annotations-2.7.4.jar HttpClient
```


